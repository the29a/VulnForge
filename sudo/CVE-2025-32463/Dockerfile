FROM ubuntu:24.10
LABEL maintainer="the29a"

ARG DEBIAN_FRONTEND=noninteractive
ENV TZ=Europe/Moscow

ARG USER_NAME=vulnforge
ARG USER_PASS=vulnforge123

RUN apt update \
	&& apt install -y -qq \
	sudo=1.9.15p5-3ubuntu5 \
	openssh-server \
	tzdata \
	gcc \
	&& ln -snf /usr/share/zoneinfo/$TZ /etc/localtime \
	&& echo $TZ > /etc/timezone \
	&& dpkg-reconfigure -f noninteractive tzdata \
	&& rm -rf /var/lib/apt/lists/* 

RUN useradd -m -s /bin/bash $USER_NAME && \
    echo "$USER_NAME:$USER_PASS" | chpasswd \
	&& echo 'vulnforge ALL = NOPASSWD: /usr/sbin/sshd' > /etc/sudoers.d/vulnforge

ENV PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
RUN echo 'PermitRootLogin no' >> /etc/ssh/sshd_config


COPY entrypoint.sh /usr/local/bin/entrypoint.sh
COPY CVE-2025-32463.sh /home/${USER_NAME}/CVE-2025-32463.sh
RUN chmod +x /usr/local/bin/entrypoint.sh \ 
	&& chown ${USER_NAME} /home/${USER_NAME}/CVE-2025-32463.sh \
	&& chmod +x /home/${USER_NAME}/CVE-2025-32463.sh


#CMD ["/usr/sbin/sshd", "-D"]
USER $USER_NAME
WORKDIR /home/${USER_NAME}


ENTRYPOINT ["/usr/local/bin/entrypoint.sh"]  