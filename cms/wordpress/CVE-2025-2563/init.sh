#!/bin/sh

mkdir -p /var/www/html/wp-content/uploads
chown -R www-data:www-data /var/www/html/wp-content

# Wait MySQL
sleep 30

if ! gosu www-data wp core is-installed; then
    gosu www-data wp core install \
        --url="http://localhost:8080" \
        --title="${WORDPRESS_SITE_TITLE}" \
        --admin_user="${WORDPRESS_ADMIN_USER}" \
        --admin_password="${WORDPRESS_ADMIN_PASSWORD}" \
        --admin_email="${WORDPRESS_ADMIN_EMAIL}" \
        --skip-email
fi

gosu www-data wp option update users_can_register 1
gosu www-data wp rewrite structure '/index.php/%postname%/'
gosu www-data wp plugin activate user-registration
exec apachectl -D FOREGROUND
