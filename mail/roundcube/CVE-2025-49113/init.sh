#!/bin/sh

echo -n "Waiting for MariaDB"; until mysqladmin -h db ping -p${DB_PASS} --silent; do
  sleep 1; echo -n "."; 
done; echo " MariaDB is up"

mysql -h db -u root -p${DB_PASS} -e "CREATE DATABASE IF NOT EXISTS roundcube CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;"
mysql -h db -u root -p${DB_PASS} -e "CREATE USER IF NOT EXISTS 'vulnforge'@'%' IDENTIFIED BY 'vulnforge123';"
mysql -h db -u root -p${DB_PASS} -e "GRANT ALL PRIVILEGES ON roundcube.* TO 'vulnforge'@'%';"
mysql -h db -u root -p${DB_PASS} -e "FLUSH PRIVILEGES;"
mysql -h db -u root -p${DB_PASS} roundcube < /var/www/html/SQL/mysql.initial.sql

# Run supervisord
exec /usr/bin/supervisord -c /etc/supervisor/supervisord.conf