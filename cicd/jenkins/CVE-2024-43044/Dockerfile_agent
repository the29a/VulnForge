FROM ubuntu:latest
LABEL maintainer="the29a"

ENV TZ=Europe/Moscow

USER root
WORKDIR /home/jenkins
RUN apt update ; apt install -y -qq \
    openjdk-17-jdk \
    curl \
    openssh-server \
    maven \
    git \
    sudo 

RUN adduser jenkins \
    --disabled-password \
    --home /home/jenkins && \
    mkdir .ssh && \
    mkdir /var/run/sshd && \
    mkdir agent && \
    chmod 777 agent && \
    chown -R jenkins /home/jenkins/

ADD ./ssh/jenkins_key.pub .ssh/authorized_keys
RUN sudo echo "PasswordAuthentication no" >> /etc/ssh/ssh_config && \
    sudo adduser jenkins sudo

RUN service ssh start

CMD ["/usr/sbin/sshd", "-D"]



# RUN curl -sO http://jenkins:8080/jnlpJars/agent.jar