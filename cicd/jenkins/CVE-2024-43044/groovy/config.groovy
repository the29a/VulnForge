// Set env JENKINS_HOME
def jenkinsHome = System.getenv('JENKINS_HOME')
println "JENKINS_HOME is ${jenkinsHome}"

// Set up credential via jenkins-cli
def command1 = "java -jar ${jenkinsHome}/jar/jenkins-cli.jar -s http://localhost:8080/ groovy = < ${jenkinsHome}/groovy/add-credentials.groovy"
println new ProcessBuilder('sh','-c',command1).redirectErrorStream(true).start().text

// Set up agent via jenkins-cli
def command2 = "java -jar ${jenkinsHome}/jar/jenkins-cli.jar -s http://localhost:8080/ -auth admin:admin create-node vulnforge-agent < ${jenkinsHome}/xml/add-agent.xml"
println new ProcessBuilder('sh','-c',command2).redirectErrorStream(true).start().text