FROM jenkins/jenkins:2.441-jdk17
LABEL maintainer="the29a"

# Copy plugins list (configuration-as-code is required)
COPY plugins.txt /usr/share/jenkins/ref/plugins.txt

# https://www.jenkins.io/doc/book/managing/groovy-hook-scripts/#post-initialization-script-init-hook
COPY groovy/config.groovy groovy/config.groovy
COPY groovy/add-credentials.groovy groovy/add-credentials.groovy
ADD xml xml
ADD jar jar


# Install plugins from plugins.txt
RUN /usr/bin/jenkins-plugin-cli --plugin-file /usr/share/jenkins/ref/plugins.txt
#RUN java -jar $JENKINS_HOME/jar/jenkins-cli.jar -s http://localhost:8080/ groovy = < $JENKINS_HOME/groovy/add-credentials.groovy
#RUN java -jar $JENKINS_HOME/jar/jenkins-cli.jar -s http://localhost:8080/ -auth admin:admin create-node vulnforge-agent < $JENKINS_HOME/xml/add-agent.xml

# Optional config 
ENV CASC_JENKINS_CONFIG=/var/jenkins_home/jcas/jenkins.yaml
ENV JAVA_OPTS="-Djenkins.install.runSetupWizard=false"
